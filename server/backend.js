!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n){return e.isAuthenticated()?(t.locals.loggedIn=!0,n()):(t.locals.loggedIn=!1,void t.json({error:"Unauthorized"}))}function a(e,t,n){e.session.passport.user.username;w.isUndefined(e.session.passport.user.role)||"admin"!==e.session.passport.user.role?t.json({error:"Unauthorized"}):n()}function o(e){return new u["default"](function(t,r){if(!C){var a=n(116)(p);console.log("INITIALIZING");var o=n(58);a.on("connection",function(t){global._socket=t;new o(t,a,e);console.log("CONNECTED",t.id)}),C=!0}t()})}var s=n(7),u=t(s),i=n(103),c=n(101),l=(n(104),n(102)),f=n(107),d=i(),p=n(106).Server(d),h=n(98),v=(n(110),n(111),n(46)),y=n(51),g=n(99),m=n(9),x=n(112),w=n(6),b=n(114),k=process.env.JARVIS_DEV||!1,U=m.get("graph"),T=m.get("user"),_=n(22),N=new _,E=m.get("rethink"),S=n(10),A=new S,R=n(57),M=n(55),O=n(54),I={},j=n(117)({host:E.host||"104.131.111.80"});global.thinky=j;var C=!1,q=n(113).Strategy,P="a595d84888f2d2a687a4",F="3279791b36883a5138acf4db4080a5982faee3d8";x.use(new q({clientID:P,clientSecret:F,callbackURL:"http://localhost:3000/auth/github/callback"},function(e,t,n,r){A.getSaveUserInGraph({username:n.username}).then(function(e){return r(null,e)})["catch"](r)})),x.serializeUser(function(e,t){t(null,e)}),x.deserializeUser(function(e,t){A.getSaveUserInGraph({username:e.username}).then(function(e){return t(null,e)})["catch"](t)}),setTimeout(function(){d.use(h.json()),d.use(h.urlencoded({extended:!0})),d.use(function(e,t,n){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),n()}),d.use(c()),d.use(l({name:"jarvis-session",keys:["key-1"]})),d.use(x.initialize()),d.use(x.session()),d.get("/auth/github",x.authenticate("github")),d.get("/auth/github/callback",x.authenticate("github",{failureRedirect:"/login"}),function(e,t){e.session.user=e.user,t.redirect("http://localhost:3000")}),d.post("/api/user/userjson",r,function(e,t){t.send(e.user)}),d.use("/teams",f({target:"http://localhost:8888/teams",changeOrigin:!0})),d.get("/user",function(e,t){void 0===e.user?t.json({}):t.json(e.user)}),d.get("/init",r,function(e,t){console.log("STARTING UP"),I=e.session,o(e.session.user).then(function(){t.send("done")})}),d.get("/users",y.getUsers),d.post("/open",function(e,t){var n=N.getRootPath(),r=e.body.address,a=e.body.type,o=void 0;switch(a){case"url":o='open -a "Google Chrome" '+r;break;case"file":o='open -a "Atom" '+n+r}g.exec(o,function(){})}),d.post("/health",function(e,t){t.json({status:"healthy"})}),d.post("/query",y.query),d.post("/blacklist",y.blacklistNode),d.get("/api/teams",function(e,t){var n=e.session.user.id;M.getTeamsByUserId(n).then(function(e){t.json(e)})}),d.post("/api/team/all",[r,a],function(e,t){M.getAllTeams().then(function(e){t.json(e)})}),d.post("/api/user/teams",r,function(e,t){var n=e.body.userId||e.session.passport.user.id;M.getTeamsByUserId(n).then(function(e){t.json(e)})}),d.post("/api/user/accessibleTeams",r,function(e,t){var n=(e.body.userId||e.session.passport.user.id,e.body.username||e.session.passport.user.username);R.getAccessibleTeams(n).then(function(e){t.json(e)})}),d.post("/api/user/teams/members",r,function(e,t){var n=e.session.passport.user.id;M.getTeamMembersByUserId(n).then(function(e){t.json(e)})}),d.post("/api/user/setAsAdmin",[r,a],function(e,t){var n=e.session.passport.user.username;R.setUserAsAdmin(n).then(function(e){})}),d.post("/api/user/create",[r,a],function(e,t){var n=e.body,r=n.username,a=n.role;R.createUser(r,a).then(function(e){t.json(e)})}),d.post("/api/user/all",a,function(e,t){R.getAllUsers().then(function(e){t.json(e)})}),d.post("/api/user/associate",a,function(e,t){var n=e.body,r=n.username,a=n.teamname;M.inviteUserToTeam(r,a).then(function(e){t.json({relationship:e})})}),d.post("/api/user/teams/invites",r,function(e,t){var n=e.body.username;console.log("Getting invites for",n),R.getTeamInvites(n).then(function(e){console.log("invites for ",n,e),t.json(e)})}),d.post("/api/user/join",r,function(e,t){var n=e.session.passport.user.username,r=e.body.teamname;M.relateUserToTeam(n,r).then(function(e){t.json({relationship:e})})}),d.post("/api/user/setRootPath",r,function(e,t){var n=e.body,r=(n.username,n.rootPath);O.setRootPath(r).then(function(e){t.json({rootPath:e})})}),d.post("/api/user/getRootPath",r,function(e,t){O.getRootPath().then(function(e){t.json(e)})}),d.post("/api/team/create",a,function(e,t){var n=e.body.teamname;M.getSaveTeam(n).then(function(e){t.json({teamNode:e})})}),d.post("/logout",function(e,t){e.session=null,console.log("LOGGING OUT"),t.redirect("/")}),"false"!=k?(console.log("DEVELOPMENT MODE"),d.use("/",f({target:"http://localhost:8888",changeOrigin:!0}))):(console.log("PRODUCTION MODE"),d.use(i["static"](b.join(e,"../../client/build"))));var t=v.connect({host:E.host||"104.131.111.80",db:E.db});t.then(function(e){}),p.listen(3e3,function(){console.log("CONFIG",U,T,E),console.log("listening on *:3000")})},1e3)}).call(t,"/")},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var a=n(7),o=r(a);t["default"]=function(e){return function(){var t=e.apply(this,arguments);return new o["default"](function(e,n){function r(a,s){try{var u=t[a](s),i=u.value}catch(c){return void n(c)}return u.done?void e(i):o["default"].resolve(i).then(function(e){return r("next",e)},function(e){return r("throw",e)})}return r("next")})}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}t.__esModule=!0;var a=n(59),o=r(a);t["default"]=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,o["default"])(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){e.exports=n(115)},function(e,t,n){var r=n(40)("wks"),a=n(43),o=n(8).Symbol,s="function"==typeof o,u=e.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:a)("Symbol."+e))};u.store=r},function(e,t){e.exports=require("lodash")},function(e,t,n){e.exports={"default":n(62),__esModule:!0}},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=require("config")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(7),u=r(s),i=n(2),c=r(i),l=n(1),f=r(l),d=n(3),p=r(d),h=n(109),v=n(9),y=new h,g=(y.pipeline(),n(6)),m=v.get("graph"),x=n(12)({user:m.user,pass:m.pass,server:m.server});x.constraints.uniqueness.create("User","username",function(e,t){}),x.constraints.uniqueness.create("Url","address",function(e,t){}),x.constraints.uniqueness.create("File","address",function(e,t){}),x.constraints.uniqueness.create("Command","address",function(e,t){});var w=function(){function e(){(0,f["default"])(this,e)}return(0,p["default"])(e,[{key:"getNode",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new u["default"](function(n,a){var o={type:e};o[t]=r,x.find(o,function(e,t){e?a(e):n(t)})}));case 1:case"end":return n.stop()}},n,this)}));return e}()},{key:"queryGraph",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new u["default"](function(n,r){x.query(e,t,function(e,t){e?r(e):n(t)})})}},{key:"getNodeById",value:function(e){return new u["default"](function(t,n){x.read(e,function(e,r){r=r?r:{},e?n(e):t(r)})})}},{key:"getUrlNodeByUrl",value:function(e){return new u["default"](function(t,n){console.log("FINDING",e),x.find({type:"url",url:e},function(e,r){e?(console.log(e),n(e)):(console.log("URLS",r),t(r[0]))})})}},{key:"getUserNodeByUsername",value:function(e){return new u["default"](function(t,n){x.find({username:e},function(e,r){e?(console.log(e),n(e)):t(r[0])})})}},{key:"getRelatedToUrl",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){var a,s,u,i;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getUrlNodeByUrl(e);case 2:return a=n.sent,s="MATCH (n:Url)-[r:"+t+']-(q) WHERE n.url = "'+e+'" AND r.weight > '+r+"  RETURN r,q ORDER BY r.weight DESC LIMIT 10",u={url:e,threshold:r},n.prev=5,n.next=8,this.queryGraph(s,u);case 8:return i=n.sent,n.abrupt("return",i);case 12:n.prev=12,n.t0=n["catch"](5),console.log("failed to get related",n.t0);case 15:case"end":return n.stop()}},n,this,[[5,12]])}));return e}()},{key:"getRelevantNodes",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getRelevantUrls();case 2:return e=t.sent,t.abrupt("return");case 4:case"end":return t.stop()}},n,this)}));return e}()},{key:"getRelevantUrls",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(){var e,t;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=this.context.urls.map(function(e){return e.url}),n.next=3,u["default"].all(e.map(function(e){return x.getRelatedToUrl(e,"openwith",30)}));case 3:return t=n.sent,n.abrupt("return",t);case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"relateOneToMany",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){var a,s,u,i,c=this;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a=[],s=void 0,u=[],n.prev=3,s=x.batch(),i=t.map(function(t){return c.getRelateNodeQuery(e,t,r)}),i.forEach(function(e){s.query(e,{},function(e,t){e&&console.log("err adding to txn",e)})}),u=this.commitBatch(s),n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](3),console.log("failed",n.t0);case 13:return n.prev=13,n.abrupt("return",u);case 16:case"end":return n.stop()}},n,this,[[3,10,13,16]])}));return e}()},{key:"commitBatch",value:function(e){return new u["default"](function(t,n){try{e.commit(function(e,r){e&&n(e),t(r)})}catch(r){console.log("cant commit",r),n(r)}finally{}})}},{key:"getRelateNodeQuery",value:function(e,t,n){var r="START a=node("+e.id+"), b=node("+t.id+") MERGE (a)-[r:"+n+"]->(b) SET r.weight = coalesce(r.weight, 0) + 1";return r}},{key:"deleteRelationship",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){var a,s;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a="MATCH (a)-[r:"+r+"]->(b) where ID(a)="+e.id+" and ID(b)="+t.id+" DELETE r",console.log(a),s={},n.prev=3,n.next=6,this.queryGraph(a);case 6:s=n.sent,n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](3),console.log("failed delete relatioship in graphUtil",n.t0,a);case 12:return n.prev=12,n.abrupt("return",s);case 15:case"end":return n.stop()}},n,this,[[3,9,12,15]])}));return e}()},{key:"relateNodes",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){var a,s,u;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a="START a=node({origin}), b=node({target}) MERGE (a)-[r:"+r+"]->(b) SET r.weight = coalesce(r.weight, 0) + 1",s={origin:e.id,target:t.id,relationship:r},u={},n.prev=3,n.next=6,this.queryGraph(a,s);case 6:u=n.sent,n.next=12;break;case 9:n.prev=9,n.t0=n["catch"](3),console.log("failed relate nodes in graphUtil",n.t0,a);case 12:return n.prev=12,n.abrupt("return",u);case 15:case"end":return n.stop()}},n,this,[[3,9,12,15]])}));return e}()},{key:"getSaveUserInGraph",value:function(e){return new u["default"](function(t,n){x.find(e,function(r,a){r||!a.length?(console.log("user doesnt exist, saving",e),x.save(e,"User",function(r,a){r?(console.log("CANT SAVE USER",e,r),n(r)):(console.log("USER SAVED",a),t(a))})):t(a[0])})})}},{key:"saveFile",value:function(e){var t=e.replace("projectsPath","");return new u["default"](function(n,r){console.log("SAVING FILE"),x.save({type:"file",address:t},"File",function(t,a){a=a?a:{type:"file",address:e},t?(console.log("err",t),r(t)):(console.log("node",a),n(a))})})}},{key:"getFile",value:function(e){return new u["default"](function(t,n){x.find({type:"file",address:e},function(r,a){a=a?a[0]:{type:"file",address:e},r?n(r):t(a)})})}},{key:"getAndSaveUrlNode",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){var t,r,a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.url,r=e.title,console.log("getAndSaveUrlNode",t,r),a=void 0,n.prev=4,n.next=7,this.saveUrl(t,r);case 7:a=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](4),console.log("cant get save url");case 13:return n.prev=13,n.abrupt("return",a);case 16:case"end":return n.stop()}},n,this,[[4,10,13,16]])}));return e}()},{key:"saveUrl",value:function(e,t){var n=this;return new u["default"](function(r,a){n.getUrl(e).then(function(a){var o=a;if(g.isUndefined(o))try{x.save({type:"url",address:e,keywords:"",title:t},"Url",function(t,a){if(t)try{n.getUrl(e).then(function(e){o=e,console.log("already existed",o),r(o)})}catch(s){console.log("cant get or save url",s)}finally{}else o=a,console.log("SAVED URL",a),r(o)})}catch(s){console.log("url probably exist",s)}else r(o)})})}},{key:"getUrl",value:function(e){return new u["default"](function(t,n){x.find({type:"url",address:e},function(e,r){r=!!r&&r[0],e?n(e):t(r)})})}},{key:"getCommand",value:function(e){return new u["default"](function(t,n){x.find({type:"command",address:e},function(e,r){r=!!r&&r[0],e?n(e):t(r)})})}},{key:"saveCommand",value:function(e){var t=this;return new u["default"](function(n,r){t.getCommand(e).then(function(r){var a=r;if(g.isUndefined(a))try{x.save({type:"command",address:e},"Command",function(r,o){if(r)try{t.getCommand(e).then(function(e){a=e,console.log("already existed",a),n(a)})}catch(s){console.log("cant get or save command",s)}finally{}else a=o,console.log("SAVED COMMAND",o),n(a)})}catch(o){console.log("command probably exist",o)}else n(a)})})}}]),e}();e.exports=w},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t){e.exports=require("seraph")},function(e,t,n){var r=n(21);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){e.exports=!n(35)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(17),a=n(39);e.exports=n(14)?function(e,t,n){return r.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t){e.exports={}},function(e,t,n){var r=n(13),a=n(67),o=n(88),s=Object.defineProperty;t.f=n(14)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),a)try{return s(e,t,n)}catch(u){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(23);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(32),o=r(a),s=n(7),u=r(s),i=n(4),c=r(i),l=n(2),f=r(l),d=n(1),p=r(d),h=n(3),v=r(h),y=n(44),g=n(96),m=function(){function e(){var t=this;(0,p["default"])(this,e),this.readSettingsFile().then(function(e){t.rootPath=e.rootPath})}return(0,v["default"])(e,[{key:"setRootPath",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e){var t,r;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.rootPath=e,n.next=3,this.readSettingsFile();case 3:return t=n.sent,t.rootPath=e,n.next=7,this.saveSettings(t);case 7:return r=n.sent,n.abrupt("return",this.rootPath);case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"getRootPath",value:function(){return this.rootPath}},{key:"readSettingsFile",value:function(){return new u["default"](function(e,t){var n=void 0;y.readFile(g,"utf8",function(t,r){t?console.log("cant read settings file",t):(n=JSON.parse(r),console.log("READ SETTINGS",n),e(n))})})}},{key:"saveSettings",value:function(e){return new u["default"](function(t,n){y.writeFile(g,(0,o["default"])(e),function(n){n?console.log("error saving settings",n):(console.log("SAVED SETTINGS"),t(e))})})}}]),e}();e.exports=m},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(21),a=n(8).document,o=r(a)&&r(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},function(e,t,n){var r=n(8),a=n(11),o=n(19),s=n(15),u="prototype",i=function(e,t,n){var c,l,f,d=e&i.F,p=e&i.G,h=e&i.S,v=e&i.P,y=e&i.B,g=e&i.W,m=p?a:a[t]||(a[t]={}),x=m[u],w=p?r:h?r[t]:(r[t]||{})[u];p&&(n=t);for(c in n)l=!d&&w&&void 0!==w[c],l&&c in m||(f=l?w[c]:n[c],m[c]=p&&"function"!=typeof w[c]?n[c]:y&&l?o(f,r):g&&w[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[u]=e[u],t}(f):v&&"function"==typeof f?o(Function.call,f):f,v&&((m.virtual||(m.virtual={}))[c]=f,e&i.R&&x&&!x[c]&&s(x,c,f)))};i.F=1,i.G=2,i.S=4,i.P=8,i.B=16,i.W=32,i.U=64,i.R=128,e.exports=i},function(e,t,n){var r=n(17).f,a=n(20),o=n(5)("toStringTag");e.exports=function(e,t,n){e&&!a(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},function(e,t,n){var r=n(40)("keys"),a=n(43);e.exports=function(e){return r[e]||(r[e]=a(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(69),a=n(24);e.exports=function(e){return r(a(e))}},function(e,t){e.exports=require("moniker")},function(e,t,n){e.exports={"default":n(60),__esModule:!0}},function(e,t,n){var r=n(18),a=n(5)("toStringTag"),o="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(n){}};e.exports=function(e){var t,n,u;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),a))?n:o?r(t):"Object"==(u=r(t))&&"function"==typeof t.callee?"Arguments":u}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,n){e.exports=n(8).document&&document.documentElement},function(e,t,n){"use strict";var r=n(38),a=n(26),o=n(82),s=n(15),u=n(20),i=n(16),c=n(72),l=n(27),f=n(78),d=n(5)("iterator"),p=!([].keys&&"next"in[].keys()),h="@@iterator",v="keys",y="values",g=function(){return this};e.exports=function(e,t,n,m,x,w,b){c(n,t,m);var k,U,T,_=function(e){if(!p&&e in A)return A[e];switch(e){case v:return function(){return new n(this,e)};case y:return function(){return new n(this,e)}}return function(){return new n(this,e)}},N=t+" Iterator",E=x==y,S=!1,A=e.prototype,R=A[d]||A[h]||x&&A[x],M=R||_(x),O=x?E?_("entries"):M:void 0,I="Array"==t?A.entries||R:R;if(I&&(T=f(I.call(new e)),T!==Object.prototype&&(l(T,N,!0),r||u(T,d)||s(T,d,g))),E&&R&&R.name!==y&&(S=!0,M=function(){return R.call(this)}),r&&!b||!p&&!S&&A[d]||s(A,d,M),i[t]=M,i[N]=g,x)if(k={values:E?M:_(y),keys:w?M:_(v),entries:O},b)for(U in k)U in A||o(A,U,k[U]);else a(a.P+a.F*(p||S),t,k);return k}},function(e,t){e.exports=!0},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(8),a="__core-js_shared__",o=r[a]||(r[a]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,n){var r,a,o,s=n(19),u=n(68),i=n(36),c=n(25),l=n(8),f=l.process,d=l.setImmediate,p=l.clearImmediate,h=l.MessageChannel,v=0,y={},g="onreadystatechange",m=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},x=function(e){m.call(e.data)};d&&p||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++v]=function(){u("function"==typeof e?e:Function(e),t)},r(v),v},p=function(e){delete y[e]},"process"==n(18)(f)?r=function(e){f.nextTick(s(m,e,1))}:h?(a=new h,o=a.port2,a.port1.onmessage=x,r=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",x,!1)):r=g in c("script")?function(e){i.appendChild(c("script"))[g]=function(){i.removeChild(this),m.call(e)}}:function(e){setTimeout(s(m,e,1),0)}),e.exports={set:d,clear:p}},function(e,t,n){var r=n(29),a=Math.min;e.exports=function(e){return e>0?a(r(e),9007199254740991):0}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("rethinkdb")},function(e,t){e.exports=require("watson-developer-cloud")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(7),u=r(s),i=n(2),c=r(i),l=n(1),f=r(l),d=n(3),p=r(d),h=(n(6),n(9)),v=n(22),y=new v,g=n(10),m=new g,x=h.get("user"),w=(x.projectsPath,function(){function e(t,n,r,a){(0,f["default"])(this,e),this.socket=t,this.registerEvents(),this.tabs=[],this.activeTab={},this.io=n,this.context=r,this.history=a}return(0,p["default"])(e,[{key:"registerEvents",value:function(){var e=this;e.socket.on("atom-connected",function(){console.log("atom-connected",e.socket.id)}),e.socket.on("atom-highlighted",function(t){var n=t.uri;e.handleFileHighlighted(n).then(function(e){})})}},{key:"relateOneToMany",value:function(){function e(e,n,r){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e,t,r){var a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=[],n.prev=1,n.next=4,u["default"].all(t.map(function(t){return m.relateNodes(e,t,r)}));case 4:a=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](1),console.log("failed to relate one to many",n.t0);case 10:return n.abrupt("return",a);case 11:case"end":return n.stop()}},n,this,[[1,7]])}));return e}()},{key:"getAndSave",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){var t,r;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=this,n.next=3,m.getFile(e);case 3:if(r=n.sent){n.next=9;break}return console.log("saving"),n.next=8,m.saveFile(e);case 8:r=n.sent;case 9:return n.abrupt("return",r);case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"handleFileHighlighted",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){var t,r,a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.insertUniqueFile(e);case 2:return t=n.sent,r=this.tabs.filter(function(e){return e.id!==t.id}),n.next=6,this.relateOneToMany(t,r,"openwith");case 6:return a=n.sent,this.context.addFileNode(t),this.history.saveEvent({type:"highlighted",source:"atom",data:{nodeId:t.id,address:e}}).then(function(e){}),n.abrupt("return",a);case 10:case"end":return n.stop()}},n,this)}));return e}()},{key:"handleFileClose",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.removeUniqueFile(e);case 1:case"end":return t.stop()}},n,this)}));return e}()},{key:"insertUniqueFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){var t,r,a,s;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=y.getRootPath(),r=e.replace(t,""),n.next=4,this.getAndSave(r);case 4:return a=n.sent,s=this.tabs.filter(function(e){return e.address===a.address}),0==s.length&&this.tabs.push(a),n.abrupt("return",a);case 8:case"end":return n.stop()}},n,this)}));return e}()},{key:"removeUniqueFile",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(o["default"].mark(function n(e){var t,r;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getAndSave(e);case 2:t=n.sent,r=this.tabs.filter(function(e){return e.address===t.address}),r.length>0&&(this.tabs=this.tabs.filter(function(t){return t.address!==e}));case 5:case"end":return n.stop()}},n,this)}));return e}()}]),e}());e.exports=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(2),u=r(s),i=n(1),c=r(i),l=n(3),f=r(l),d=(n(97),n(6)),p=(n(45),n(9),n(10)),h=new p,v=!0,y=function(){function e(t,n,r,a){(0,c["default"])(this,e),this.socket=t,this.tabs=[],this.urls=[],this.activeTab={},this.io=n,this.context=r,this.history=a,this.io.emit("load-tabs"),this.registerEvents()}return(0,f["default"])(e,[{key:"registerEvents",value:function(){var e=this;e.socket.on("chrome-init",function(t){console.log("chrome-init"),console.log("found ",t.length,"tabs."),e.tabs=t,e.saveSession(),e.socket.emit("chrome-enabled")}),e.socket.on("chrome-created",function(t){var n=(t.active,t.tabs);console.log("chrome-created",n.length),e.tabs=n,console.log("Found ",e.tabs.length,"tabs"),e.saveSession()}),e.socket.on("chrome-highlighted",function(t){var n=t.active,r=t.tabs;e.tabs=r,console.log("===>TABS",r.length,n),e.handleHighlighted(n).then(function(t){e.io.emit("related",t)})}),e.socket.on("chrome-updated",function(){var t=(0,u["default"])(o["default"].mark(function n(t){var r,a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("chrome-updated"),r=t.active,a=t.tabs,e.tabs=a,n.next=6,e.saveSession();case 6:e.handleUpdated(r).then(function(){}),e.saveSession();case 8:case"end":return n.stop()}},n,this)}));return function(e){return t.apply(this,arguments)}}()),e.socket.on("chrome-disable",function(){v=!1,e.io.emit("chrome-disabled")}),e.socket.on("chrome-enable",function(){v=!0,e.io.emit("chrome-enabled")}),e.socket.on("heartbeat",function(t){e.saveSession()})}},{key:"saveSession",value:function(){function e(){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this,this.context.updateTabs(e.tabs),t.abrupt("return",!0);case 3:case"end":return t.stop()}},n,this)}));return e}()},{key:"getActiveTab",value:function(e){return this.tabs.filter(function(t){return t.id===e})}},{key:"handleUpdated",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r,a,s;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(v){n.next=3;break}return console.log("Chrome extension disabled"),n.abrupt("return");case 3:return t=this.getActiveTab(e),console.log("HANDLE UPDATED --- ACTIVE TAB"),r=t[0].url,a=t[0].title,n.next=9,h.getUrlNodeByUrl(t[0].url);case 9:if(s=n.sent,!d.isUndefined(s)){n.next=14;break}return n.next=13,h.saveUrl(r,a);case 13:s=n.sent;case 14:console.log("NODE",s,this.context.activeUrl),this.context.activeUrl.url!==t[0].url&&(this.context.setActiveUrl({url:r,title:a}),this.history.saveEvent({type:"highlighted",source:"chrome",data:{nodeId:s.id,address:r,title:a}}).then(function(e){}));case 16:case"end":return n.stop()}},n,this)}));return e}()},{key:"handleHighlighted",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r,a,s,u;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(v){n.next=3;break}return console.log("Chrome extension disabled"),n.abrupt("return");case 3:if(t=this.getActiveTab(e.tabIds[0]),r="",a="",t[0]){n.next=10;break}return n.abrupt("return",[]);case 10:r=t[0].title,a=t[0].url;case 12:return s={url:a,title:r},console.log("ACTIVE URL ",s),n.next=16,this.context.setActiveUrl(s);case 16:u=n.sent,this.history.saveEvent({type:"highlighted",source:"chrome",data:{nodeId:u.id,address:s.url,title:t[0].title}}).then(function(e){});case 18:case"end":return n.stop()}},n,this)}));return e}()}]),e}();e.exports=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(7),o=r(a),s=n(4),u=r(s),i=n(2),c=r(i),l=n(1),f=r(l),d=n(3),p=r(d),h=n(105),v=n(6),y=(n(47),n(46),n(9)),g=n(10),m=new g,x=n(53),w=y.get("graph"),b=(n(12)({user:w.user,pass:w.pass,server:w.server}),function(){function e(t,n){(0,f["default"])(this,e);var r=global.thinky,a=r.type;r.createModel("User",{id:a.string(),username:a.string()},{pk:"username"});this.user={},this.urls=[],this.urlsArtifacts=[],this.tabs=[],this.commands=[],this.files=[],this.activeUrl={},this.heart=h.createHeart(1e3),this.slowHeart=h.createHeart(1e3),this.history=t,this.recommendations=[],this.initContext(n)}return(0,p["default"])(e,[{key:"initContext",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){var t;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=void 0,n.prev=1,n.next=4,this.setUser(e);case 4:return t=n.sent,this.user=t,this.metadata=new x(this.user),this.heart.createEvent(30,function(e,t){this.handleHeartbeat(e)}.bind(this)),this.slowHeart.createEvent(300,function(e,t){}.bind(this)),n.abrupt("return",t);case 12:n.prev=12,n.t0=n["catch"](1),console.error("cannot initialize context",n.t0);case 15:case"end":return n.stop()}},n,this,[[1,12]])}));return e}()},{key:"setUser",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){var t;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.getSaveUserInGraph(e);case 2:return t=n.sent,this.user=t,console.log("User assigned to context",this.user),n.abrupt("return",t);case 6:case"end":return n.stop()}},n,this)}));return e}()},{key:"handleHeartbeat",value:function(e){this.saveContext()}},{key:"handleSlowHeartbeat",value:function(e){this.history.saveEvent({type:"heartbeat",source:"context",data:{files:this.files,urls:this.urls}}).then(function(e){})}},{key:"addFileNode",value:function(e){var t=this.files.filter(function(t){return t.address===e.address});0===t.length&&this.files.push(e)}},{key:"addCommandNode",value:function(e){var t=this.commands.filter(function(t){return t.address===e.address});0===t.length&&this.commands.push(e)}},{key:"updateUserActivity",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(){var e,t,r;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("updateUserActivity"),e=this.getActiveUrl(),t=void 0,n.prev=3,n.next=6,m.getAndSaveUrlNode(e);case 6:t=n.sent,console.log("updateUserActivity - ACTIVE URL",t),r=m.relateNodes(this.user,t,"touched"),
n.next=14;break;case 11:n.prev=11,n.t0=n["catch"](3),console.log("cant updateUserActivity",n.t0);case 14:return n.prev=14,n.abrupt("return",t);case 17:case"end":return n.stop()}},n,this,[[3,11,14,17]])}));return e}()},{key:"updateTabs",value:function(e){var t=e.map(function(e){return{url:e.url,title:e.title}});this.urlsArtifacts=t}},{key:"setActiveUrl",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){var t;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.activeUrl=e,t=void 0,n.prev=2,n.next=5,this.updateUserActivity();case 5:t=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),console.log("cant set active url");case 11:return n.prev=11,n.abrupt("return",t);case 14:case"end":return n.stop()}},n,this,[[2,8,11,14]])}));return e}()},{key:"getActiveUrl",value:function(){return this.activeUrl}},{key:"relateUrlsToFiles",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e,t){var r,a;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o["default"].all(e.map(function(e){return m.relateOneToMany(e,t,"openwith")}));case 2:return r=n.sent,n.next=5,o["default"].all(t.map(function(t){return m.relateOneToMany(t,e,"openwith")}));case 5:a=n.sent;case 6:case"end":return n.stop()}},n,this)}));return e}()},{key:"relateUrlsToUrls",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){var t,r=this;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=[],n.prev=1,n.next=4,o["default"].all(e.map(function(t){return r.relateUrlToOthers(t,e)}));case 4:t=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](1),console.log("error relating urls to urls",n.t0);case 10:return n.prev=10,n.abrupt("return",t);case 13:case"end":return n.stop()}},n,this,[[1,7,10,13]])}));return e}()},{key:"relateUrlToUrls",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e,t){var r,a;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.filter(function(t){return t.address!==e.address}),n.next=3,this.graph.relateOneToMany(e,r,"openwith");case 3:return a=n.sent,n.abrupt("return",a);case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"relateUrlToOthers",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e,t){var r,a;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.filter(function(t){return t.id!==e.id}),a=[],n.prev=2,n.next=5,o["default"].all(t.map(function(e){return m.relateOneToMany(e,r,"openwith")}));case 5:a=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),console.log(err);case 11:return n.prev=11,n.abrupt("return",a);case 14:case"end":return n.stop()}},n,this,[[2,8,11,14]])}));return e}()},{key:"relateFileToFiles",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e,t){var r,a;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.filter(function(e){return e.address!==e.address}),n.next=3,m.relateOneToMany(e,r,"openwith");case 3:return a=n.sent,n.abrupt("return",a);case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"relateUserToContext",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(){var e,t,r,a;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e=this,!v.isUndefined(this.user.id)){n.next=4;break}return console.log("User not set yet, cannot relate user to context"),n.abrupt("return");case 4:if(v.isEmpty(this.urls)){n.next=10;break}return n.next=7,m.relateOneToMany(this.user,this.urls,"touched");case 7:t=n.sent,n.next=10;break;case 10:if(v.isEmpty(this.files)){n.next=14;break}return n.next=13,m.relateOneToMany(this.user,this.files,"touched");case 13:r=n.sent;case 14:if(v.isEmpty(this.commands)){n.next=20;break}return n.next=17,m.relateOneToMany(this.user,this.commands,"touched");case 17:a=n.sent,n.next=20;break;case 20:case"end":return n.stop()}},n,this)}));return e}()},{key:"clearCommandsContext",value:function(){this.commands=[]}},{key:"saveContext",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(){var e,t,r,a,s,i,c;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=this,n.prev=1,t=this.urlsArtifacts,r=this.files,n.next=6,o["default"].all(t.map(function(e){return m.saveUrl(e.url,e.title)}));case 6:return a=n.sent,this.urls=a,r.length>0&&this.relateUrlsToFiles(a,r),n.next=11,this.relateUrlsToUrls(a);case 11:return s=n.sent,n.next=14,this.relateUserToContext();case 14:return i=n.sent,n.next=17,this.relateContextToItself();case 17:c=n.sent,this.clearCommandsContext(),n.next=24;break;case 21:n.prev=21,n.t0=n["catch"](1),console.error("something went wrong when creating a context",n.t0);case 24:return n.prev=24,n.finish(24);case 26:case"end":return n.stop()}},n,this,[[1,21,24,26]])}));return e}()},{key:"relateContextToItself",value:function(){function e(){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(){var e=this;return u["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(u["default"].mark(function n(){var t,r,a,s,i,c,l,f,d,p,h,v;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.urls,r=e.files,a=e.commands,!(t.length>0)){n.next=8;break}return s=o["default"].all(t.map(function(n){return e.relateUrlToUrls(n,t)})),n.next=7,o["default"].all(t.map(function(t){return e.metadata.getSetKeywordsForUrl(t)}));case 7:i=n.sent;case 8:r.length>0&&(c=o["default"].all(r.map(function(t){return e.relateFileToFiles(t,r,"openwith")}))),r.length>0&&t.length>0&&(l=o["default"].all(r.map(function(e){return m.relateOneToMany(e,t,"openwith")}))),a.length>0&&r.length>0&&(f=o["default"].all(a.map(function(e){return m.relateOneToMany(e,r,"openwith")})),d=o["default"].all(r.map(function(e){return m.relateOneToMany(e,a,"openwith")}))),a.length>0&&t.length>0&&(p=o["default"].all(a.map(function(e){return m.relateOneToMany(e,t,"openwith")})),h=o["default"].all(t.map(function(e){return m.relateOneToMany(e,a,"openwith")}))),a.length>0&&(v=o["default"].all(a.map(function(e){return m.relateOneToMany(e,a,"openwith")})));case 13:case"end":return n.stop()}},n,e)})(),"t0",2);case 2:t.next=7;break;case 4:t.prev=4,t.t1=t["catch"](0),console.log("cant relateContextToItself",t.t1);case 7:case"end":return t.stop()}},n,this,[[0,4]])}));return e}()}]),e}());e.exports=b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new l["default"](function(n,r){h.query(e,t,function(e,t){e?r(e):n(t)})})}var o=n(4),s=r(o),u=n(2),i=r(u),c=n(7),l=r(c),f=function(){var e=(0,i["default"])(s["default"].mark(function t(e){var n,r;return s["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(e);case 2:return n=t.sent,r=void 0,n.length>0?(r=parseFloat(n[0].normalizedSumWeight),r=r>0?r:1):r=1,t.abrupt("return",r);case 6:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),d=n(9),p=d.get("graph"),h=n(12)({user:p.user,pass:p.pass,server:p.server}),v={getUsers:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,i["default"])(s["default"].mark(function n(e,t){var r,o;return s["default"].wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="match (n:User) return n",e.prev=1,e.next=4,a(r);case 4:o=e.sent,t.json(o),e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](1),console.error("Query to graph for users failed",r),t.json({error:e.t0});case 12:case"end":return e.stop()}},n,this,[[1,8]])}));return e}(),query:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,i["default"])(s["default"].mark(function n(e,t){var r,o,u,i,c,l,d,p,h,v,y,g,m;return s["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.body.nodeId,o=e.body.relationshipType||!1,u=e.body.startNodeType||!1,i=e.body.endNodeType||!1,c=o?"relationship:"+o:"relationship",l=u?"startNode:"+u:"startNode",d=i?"endNode:"+i:"endNode",p=e.body.startUserNodeId||!1,h=e.body.endUserNodeIds||!1,v=void 0,y=void 0,console.log("FINDME: ",{nodeId:r,endNodeType:i,startUserNodeId:p,endUserNodeIds:h}),g=void 0,!p||h&&0!==h.length){n.next=22;break}return g="match (startUserNode:User)-[startUserRel_"+c+"]->("+l+")-[endUserRel_"+c+"]->("+d+") where ID(startNode) = "+r,g+=" and ID(startUserNode) = "+p,g+=" and NOT (startUserNode)-[:blacklisted]-("+d+")",v=g+(" return avg(endUserRel_"+c+".weight) as normalizedSumWeight"),n.next=20,f(v);case 20:y=n.sent,g+=" return startNode,type(endUserRel_"+c+") as relationshipType, (endUserRel_"+c+".weight / "+y+") as relationshipWeight, collect(distinct endNode)[0] as endNode order by relationshipWeight desc";case 22:if(!(p&&h&&h.length>0)){n.next=33;break}return g="match (startUserNode:User)-["+c+"]->("+l+")-[startUserRel_"+c+"]->("+d+")<-[endUserRel_"+c+"]-(endUserNode:User) where ID(startNode) = "+r,g+=" and ID(startUserNode) = "+p,g+=" and ID(endUserNode) in ["+h.join(",")+"]",g+=" and NOT (startUserNode)-[:blacklisted]-("+d+")",v=g+(" return avg(endUserRel_"+c+".weight) as normalizedSumWeight"),console.log("WAAAT",v),n.next=31,f(v);case 31:y=n.sent,g+=" return startNode,type(endUserRel_"+c+") as relationshipType, (endUserRel_"+c+".weight / "+y+") as relationshipWeight, collect(distinct endNode)[0] as endNode order by relationshipWeight desc";case 33:if(!(!p&&h&&h.length>0)){n.next=42;break}return g="match (startUserNode:User)-["+c+"]->("+l+")-[startUserRel_"+c+"]->("+d+")->[endUserRel_"+c+"]-(endUserNode:User) where ID(startNode) = "+r,g+=" and ID(endUserNode) in ["+h.join(",")+"]",g+=" and NOT (startUserNode)-[:blacklisted]-("+d+")",v=g+(" return avg(endUserRel_"+c+".weight) as normalizedSumWeight"),n.next=40,f(v);case 40:y=n.sent,g+=" return startNode,type(endUserRel_"+c+") as relationshipType, (endUserRel_"+c+".weight / "+y+") as relationshipWeight, collect(distinct endNode)[0] as endNode order by relationshipWeight desc";case 42:if(n.prev=42,p||h){n.next=49;break}return v="start startNode=node("+r+") match ("+l+")-["+c+"]->("+d+") return log(sum(relationship.weight)) as normalizedSumWeight",n.next=47,f(v);case 47:y=n.sent,g="\n          start startNode=node("+r+") match ("+l+")-["+c+"]-("+d+") return collect(distinct startNode)[0] as startNode, collect(distinct type(relationship))[0] as relationshipType, log(relationship.weight)/"+y+" as relationshipWeight, collect(distinct endNode)[0] as endNode order by relationshipWeight desc limit 15\n        ";case 49:return n.prev=49,n.next=52,a(g);case 52:m=n.sent,console.log("======  QUERY   ====="),console.log(""),console.log(g),console.log(""),console.log("====== END QUERY ====="),console.log("Found "+m.length+" results for the query"),t.json(m),n.next=66;break;case 62:n.prev=62,n.t0=n["catch"](49),console.error("Query to graph failed",g,n.t0),t.json({error:n.t0});case 66:n.next=72;break;case 68:n.prev=68,n.t1=n["catch"](42),console.error("Query to graph failed :-()",g,n.t1),t.json({error:n.t1});case 72:case"end":return n.stop()}},n,this,[[42,68],[49,62]])}));return e}(),blacklistNode:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,i["default"])(s["default"].mark(function n(e,t){var r,o,u;return s["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.body.nodeId,console.log("blacklist: ",e.body),o="\n      START userNode=node("+e.body.userId+"), targetNode=node("+e.body.targetId+")\n      MERGE (userNode)-[rel:blacklisted]->(targetNode)\n      return userNode, targetNode, rel\n    ",console.log("cypher: ",o),n.prev=4,n.next=7,a(o);case 7:u=n.sent,t.json(u),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](4),console.error("Blacking node("+e.body.nodeId+") for user("+e.body.userId+") failed",o),t.json({error:n.t0});case 15:case"end":return n.stop()}},n,this,[[4,11]])}));return e}()};e.exports=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(1),o=r(a),s=n(3),u=r(s),i=global.thinky,c=i.type,l=i.createModel("Event",{id:c.string(),timestamp:c.date(),source:c.string(),eventType:c.string(),data:c.object(),user:c.string()}),f=function(){function e(t,n,r){(0,o["default"])(this,e),this.user=r,this.socket=t,this.io=n}return(0,u["default"])(e,[{key:"saveEvent",value:function(e){try{var t=new l({timestamp:new Date,eventType:e.type,source:e.source,data:e.data,user:this.user});return this.io.emit("system-event",t),t.save()}catch(n){console.error("History Manager: error saving history event",n)}}},{key:"getGroupedEventByType",value:function(e,t){}}]),e}();e.exports=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(7),o=r(a),s=n(32),u=r(s),i=n(4),c=r(i),l=n(2),f=r(l),d=n(1),p=r(d),h=n(3),v=r(h),y=(n(45),n(47)),g=n(10),m=n(6),x=(n(118),n(108)),w=(n(100),n(44)),b=new g,k=y.alchemy_language({api_key:"ab2b4727617c0d529641168272d1e661634feb72"}),U=n(9),T=U.get("graph"),_=n(12)({user:T.user,pass:T.pass,server:T.server}),N=function(){function e(t){(0,p["default"])(this,e),this.user=t,this.localCache={}}return(0,v["default"])(e,[{key:"getSetKeywordsForUrl",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e){var t,r,a,o,s,u,i;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.address,t.startsWith("http")&&t.indexOf("localhost")==-1&&!t.startsWith("https://www.google.com")&&!t.startsWith("http://www.facebook.com")&&!t.startsWith("http://www.google.com")){n.next=3;break}return n.abrupt("return");case 3:if(n.prev=3,!m.isUndefined(e.alchemy)&&(m.isUndefined(e.alchemy)||"failed"!==e.alchemy)||!m.isUndefined(this.localCache[e.address])){n.next=27;break}return n.prev=5,n.next=8,this.getAlchemyKeyWords(t);case 8:return r=n.sent,n.next=11,this.saveKeywords(r);case 11:return a=n.sent,n.next=14,this.updateNodeAndRelationships(e,a);case 14:return o=n.sent,this.localCache[e.address]=!0,n.next=18,this.updateUrlKeywordFetchStatus(t,"success");case 18:s=n.sent,n.next=27;break;case 21:return n.prev=21,n.t0=n["catch"](5),this.localCache[e.address]=!0,n.next=26,this.updateUrlKeywordFetchStatus(t,"error");case 26:u=n.sent;case 27:return n.next=29,b.getRelatedToUrl(t,"related",1);case 29:return i=n.sent,n.abrupt("return",i);case 33:n.prev=33,n.t1=n["catch"](3),n.t1.message.indexOf("alchemy")!==-1?console.log("Alchemy Error: Hmm... best guess is we exceeded our API limit."):console.log("cant getset kws for url",n.t1);case 36:return n.prev=36,n.finish(36);case 38:case"end":return n.stop()}},n,this,[[3,33,36,38],[5,21]])}));return e}()},{key:"saveAndRelateKeywordsToUrl",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e,t){var r,a,o,s,u,i;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=_.batch(),a=x.List(),e.forEach(function(e){var t="MERGE (n:Keyword { type: 'keyword', text: '"+e.text+"', alchemy: true}) RETURN n";a=a.push({relevance:e.relevance,node:r.query(t,{})})}),o="MERGE (n:Url { url: "+t.address+", alchemy: 'fetched' }) RETURN n;",s=r.query(o,{}),u=x.List(),a.forEach(function(e){var t="START a=node("+e.node.id+"), b=node("+s.id+") MERGE a-[r:related]-b SET r.weight = coalesce(r.weight, 0) + "+e.relevance;console.log("Cypher:",t),u=u.push(r.query(t,{}))}),i={},n.prev=8,n.next=11,this.doCommit(r);case 11:i=n.sent,n.next=17;break;case 14:throw n.prev=14,n.t0=n["catch"](8),n.t0;case 17:return n.prev=17,n.abrupt("return",i);case 20:case"end":return n.stop()}},n,this,[[8,14,17,20]])}));return e}()},{key:"saveKeywords",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e){var t,r,a,o;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("Saving alchemy keywords:".green),x.is(e)||(e=x.fromJS(e)),t=_.batch(),e.forEach(function(e){var n="MERGE (n:Keyword { type: 'keyword', text: '"+e.get("text")+"', alchemy: true}) RETURN n";t.query(n,{})}),r="",n.prev=5,n.next=8,this.doCommit(t);case 8:r=n.sent,n.next=14;break;case 11:throw n.prev=11,n.t0=n["catch"](5),n.t0;case 14:return n.prev=14,a=r.map(function(e){return e[0]}),o=a.map(function(t){var n=e.find(function(e){return e.get("text")===t.text});if(n)return{relevance:n.get("relevance"),node:t}}),n.abrupt("return",o);case 19:case"end":return n.stop()}},n,this,[[5,11,14,19]])}));return e}()},{key:"updateNodeAndRelationships",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e,t){var r,a;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=_.batch(),t.forEach(function(t){var n="\n        START a=node("+t.node.id+"), b=node("+e.id+")\n        MERGE (a)-[r:related]->(b)\n        SET r.weight = coalesce(r.weight, 0) + "+t.relevance;r.query(n,{},function(e,t){})}),a={},n.prev=3,n.next=6,this.doCommit(r);case 6:return a=n.sent,n.abrupt("return",a);case 10:throw n.prev=10,n.t0=n["catch"](3),console.log("CANT CREATE RELS"),n.t0;case 14:return n.prev=14,n.abrupt("return",a);case 17:case"end":return n.stop()}},n,this,[[3,10,14,17]])}));return e}()},{key:"dataToFile",value:function(e,t){w.writeFile(e,(0,u["default"])(t,null,2),function(e){e&&console.log("Error writing file:".red,e)})}},{key:"doCommit",value:function(e){return new o["default"](function(t,n){try{e.commit(function(e,r){e&&n(e),t(r)})}catch(r){n(r)}finally{}})}},{key:"updateUrlKeywordFetchStatus",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e,t){var r,a;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getUrlNodeByUrl(e);case 2:return r=n.sent,r.alchemy=t,n.next=6,this.saveUrlNode(r);case 6:return a=n.sent,n.abrupt("return",a);case 8:case"end":return n.stop()}},n,this)}));return e}()},{key:"ensureWikidata",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e){return c["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m.isUndefined(e.wikidata);case 1:case"end":return t.stop()}},n,this)}));return e}()},{key:"saveKeywordWord",value:function(e){return new o["default"](function(t,n){_.save(e,function(e,r){e?n(e):t(r)})})}},{key:"saveUrlNode",value:function(e){return new o["default"](function(t,n){_.save(e,function(e,r){e?n(e):t(r)})})}},{key:"getAlchemyKeyWords",value:function(e){return console.log("Getting alchemy keywords...".green),new o["default"](function(t,n){if(e.startsWith("http")){var r={url:e,maxRetrieve:10};k.keywords(r,function(e,r){if(e)console.log("error:",e),n(e);else{(0,u["default"])(r,null,2);t(r.keywords)}})}else console.log("not http, so no kws"),t([])})}},{key:"relateKeywordToUrl",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e,t){var r,a,o;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r=this,n.next=4,r.getKeywordByText(e.text);case 4:return a=n.sent,n.next=7,r.relateNodes(a,t,"related",e.relevance);case 7:return o=n.sent,n.abrupt("return",o);case 11:n.prev=11,n.t0=n["catch"](0),console.log("cant relate keyword to url",n.t0);case 14:return n.prev=14,n.finish(14);case 16:case"end":return n.stop()}},n,this,[[0,11,14,16]])}));return e}()},{key:"relateNodes",value:function(){function e(e,n,r,a){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e,t,r,a){var o,s,u,i;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=a,s="START a=node({origin}), b=node({target}) MERGE a-[r:"+r+"]-b SET r.weight = coalesce(r.weight, 0) + "+o,u={origin:e.id,target:t.id,relationship:r},i={},n.prev=4,n.next=7,b.queryGraph(s,u);case 7:i=n.sent,n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](4),console.log("failed to relate",n.t0,u);case 13:return n.abrupt("return",i);case 14:case"end":return n.stop()}},n,this,[[4,10]])}));return e}()},{key:"getUrlNodeByUrl",value:function(e){return new o["default"](function(t,n){_.find({type:"url",url:e},function(e,r){e?(console.log(e),n(e)):t(r[0])})})}},{key:"getKeywordByText",value:function(e){return new o["default"](function(t,n){_.find({type:"keyword",text:e},function(e,r){e?n(e):t(r[0])})})}},{key:"saveKeyword",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,f["default"])(c["default"].mark(function n(e){var t,r;return c["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t="MERGE (n:Keyword { type: 'keyword', text: "+e.text+", alchemy: true}) RETURN n",n.prev=1,n.next=4,this.queryGraph(t,{});case 4:return r=n.sent,n.abrupt("return",r);case 8:n.prev=8,n.t0=n["catch"](1),console.error("!: ",error);case 11:case"end":return n.stop()}},n,this,[[1,8]])}));return e}()}]),e}();e.exports=N},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(2),u=r(s),i=n(1),c=r(i),l=n(3),f=r(l),d=n(9),p=n(10),h=(new p,n(6),n(31),n(22)),v=new h,y=d.get("graph"),g=(n(12)({user:y.user,pass:y.pass,server:y.server}),function(){function e(){(0,c["default"])(this,e)}return(0,f["default"])(e,[{key:"setRootPath",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("SET ROOT PATH"),t=v.setRootPath(e),n.abrupt("return",t);case 3:case"end":return n.stop()}},n,this)}));return e}()},{key:"getRootPath",value:function(){function e(){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(){var e;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=v.getRootPath(),t.abrupt("return",e);case 2:case"end":return t.stop()}},n,this)}));return e}()}]),e}());e.exports=new g},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(2),u=r(s),i=n(7),c=r(i),l=n(1),f=r(l),d=n(3),p=r(d),h=n(9),v=n(10),y=new v,g=n(6),m=n(31),x=h.get("graph"),w=n(12)({user:x.user,pass:x.pass,server:x.server}),b=function(){function e(){(0,f["default"])(this,e)}return(0,p["default"])(e,[{key:"getSaveTeam",value:function(e){var t=this;return new c["default"](function(){var n=(0,u["default"])(o["default"].mark(function r(n,a){var s,u;return o["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getTeamByName(e);case 2:if(s=r.sent,console.log("len",!g.isUndefined(s)&&s.length>0),!g.isUndefined(s)&&s.length>0)n(s[0]);else{console.log("Need to save");try{u=m.choose(),console.log("Saving",e,u),w.save({type:"team",address:e,name:e,password:u},"Team",function(e,t){console.log("err ",e,"node ",t),e?a("cant save team",e):n(t[0])})}catch(o){console.log("team probably exists",o)}}case 5:case"end":return r.stop()}},r,this)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"relateUserToTeam",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e,t){var r,a,s,u,i;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this,a=void 0,s=void 0,u=void 0,i=void 0,n.prev=5,n.next=8,y.getUserNodeByUsername(e);case 8:return a=n.sent,n.next=11,r.getTeamByName(t);case 11:return s=n.sent,n.next=14,y.relateNodes(a,s,"member");case 14:return u=n.sent,n.next=17,y.deleteRelationship(a,s,"invited");case 17:return i=n.sent,n.abrupt("return",u);case 21:n.prev=21,n.t0=n["catch"](5),console.log("cant relate",n.t0);case 24:case"end":return n.stop()}},n,this,[[5,21]])}));return e}()},{key:"disassociatedUserFromTeam",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e,t){var r,a,s,u,i;return o["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,a=void 0,s=void 0,u=void 0,i=void 0,t.prev=5,t.next=8,y.getUserNodeByUsername(e);case 8:return a=t.sent,t.next=11,r.getTeamByName(teamname);case 11:return s=t.sent,t.next=14,y.deleteRelationship(a,s,"memeber");case 14:return i=t.sent,t.abrupt("return",u);case 18:t.prev=18,t.t0=t["catch"](5),console.log("cant disassociate",t.t0);case 21:case"end":return t.stop()}},n,this,[[5,18]])}));return e}()},{key:"inviteUserToTeam",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e,t){var r,a,s,u;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this,a=void 0,s=void 0,u=void 0,n.prev=4,n.next=7,y.getUserNodeByUsername(e);case 7:return a=n.sent,n.next=10,r.getTeamByName(t);case 10:return s=n.sent,n.next=13,y.relateNodes(a,s,"invited");case 13:return u=n.sent,n.abrupt("return",u);case 17:n.prev=17,n.t0=n["catch"](4),console.log("cant invite",n.t0);case 20:case"end":return n.stop()}},n,this,[[4,17]])}));return e}()},{key:"getTeamByName",value:function(e){return new c["default"](function(t,n){w.find({type:"team",address:e},function(e,r){e?(console.log("cant get team by name",e),n("cant get team by name",e)):t(r[0])})})}},{key:"getTeamsByUserId",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=[],n.prev=1,r="match (user:User)-[r:member]-(team:Team) where ID(user) = "+e+" return team",n.next=5,y.queryGraph(r);case 5:t=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](1),console.log("cant find user teams",n.t0);case 11:return n.prev=11,n.abrupt("return",t);case 14:case"end":return n.stop()}},n,this,[[1,8,11,14]])}));return e}()},{key:"getTeamMembersByUserId",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=[],n.prev=1,r="match (user:User)-[r:member]-(team:Team)-[otherMemeber:member]-(targetUser:User) where ID(user) = "+e+" return targetUser",n.next=5,y.queryGraph(r);case 5:t=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](1),console.log("cant find user teams",n.t0);case 11:return n.prev=11,n.abrupt("return",t);case 14:case"end":return n.stop()}},n,this,[[1,8,11,14]])}));return e}()},{key:"getAllTeams",value:function(){return new c["default"](function(e,t){w.find({type:"team"},function(n,r){n?t("cant get team by name",n):e(r)})})}}]),e}();e.exports=new b},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),o=r(a),s=n(2),u=r(s),i=n(1),c=r(i),l=n(3),f=r(l),d=(n(6),n(10)),p=new d,h=function(){function e(t,n,r,a){(0,c["default"])(this,e),this.socket=t,this.registerEvents(),this.tabs=[],this.activeTab={},this.io=n,this.context=r,this.history=a}return(0,f["default"])(e,[{key:"registerEvents",value:function(){var e=this;e.socket.on("terminal-connected",function(){console.log("terminal-connected",e.socket.id)}),e.socket.on("terminal-command",function(t){e.handleCommand(t).then(function(e){})})}},{key:"getAndSave",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=this,n.next=3,p.getCommand(e);case 3:if(r=n.sent){n.next=8;break}return n.next=7,p.saveCommand(e);case 7:r=n.sent;case 8:return n.abrupt("return",r);case 9:case"end":return n.stop()}},n,this)}));return e}()},{key:"handleCommand",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,u["default"])(o["default"].mark(function n(e){var t,r,a;return o["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.command,r=e.response,n.next=4,this.getAndSave(t);case 4:return a=n.sent,this.context.addCommandNode(a),this.history.saveEvent({type:"command",source:"terminal",data:{nodeId:a.id,address:t,response:r}}).then(function(e){}),n.abrupt("return",a);case 8:case"end":return n.stop()}},n,this)}));return e}()}]),e}();e.exports=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(7),o=r(a),s=n(4),u=r(s),i=n(2),c=r(i),l=n(1),f=r(l),d=n(3),p=r(d),h=n(9),v=n(10),y=new v,g=(n(6),n(31),h.get("graph")),m=n(12)({user:g.user,pass:g.pass,server:g.server}),x=function(){function e(){(0,f["default"])(this,e)}return(0,p["default"])(e,[{key:"setUserAsAdmin",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){var t;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,y.getUserNodeByUsername(e);case 2:t=n.sent,t.role="admin",m.save(t,function(e,t){console.log("Set user role to admin",t)});case 5:case"end":return n.stop()}},n,this)}));return e}()},{key:"getTeamInvites",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e){return u["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new o["default"](function(){var t=(0,c["default"])(u["default"].mark(function n(t,r){var a,o;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a="match (user:User)-[:invited]-(team:Team) where user.username='"+e+"' return team",o=void 0,n.prev=2,n.next=5,y.queryGraph(a);case 5:o=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),console.log("cant get invites",n.t0);case 11:return n.prev=11,t(o),n.finish(11);case 14:case"end":return n.stop()}},n,this,[[2,8,11,14]])}));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},n,this)}));return e}()},{key:"createUser",value:function(){function e(e,n){return t.apply(this,arguments)}var t=(0,c["default"])(u["default"].mark(function n(e,t){var r;return u["default"].wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,y.getSaveUserInGraph({username:e,role:t});case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}},n,this)}));return e}()},{key:"getAllUsers",value:function(){return new o["default"](function(){var e=(0,c["default"])(u["default"].mark(function t(e,n){var r,a;return u["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="match (u:User) return u",t.next=3,y.queryGraph(r);case 3:a=t.sent,e(a);case 5:case"end":return t.stop()}},t,this)}));return function(t,n){return e.apply(this,arguments)}}())}}]),e}();e.exports=new x},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(1),o=r(a),s=n(49),u=n(48),i=n(56),c=n(50),l=n(52),f=n(6),d={},p=function h(e,t,n){(0,o["default"])(this,h);var r=new l(e,t,n.username);f.isUndefined(d.user)&&(d=new c(r,{username:n.username})),this.chrome=new s(e,t,d,r),this.atom=new u(e,t,d,r),this.terminal=new i(e,t,d,r),console.log("All controller instantiated")};e.exports=p},function(e,t,n){e.exports={"default":n(61),__esModule:!0}},function(e,t,n){var r=n(11),a=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},function(e,t,n){n(91);var r=n(11).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){n(92),n(94),n(95),n(93),e.exports=n(11).Promise},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(30),a=n(42),o=n(86);e.exports=function(e){return function(t,n,s){var u,i=r(t),c=a(i.length),l=o(s,c);
if(e&&n!=n){for(;c>l;)if(u=i[l++],u!=u)return!0}else for(;c>l;l++)if((e||l in i)&&i[l]===n)return e||l||0;return!e&&-1}}},function(e,t,n){var r=n(19),a=n(71),o=n(70),s=n(13),u=n(42),i=n(89),c={},l={},t=e.exports=function(e,t,n,f,d){var p,h,v,y,g=d?function(){return e}:i(e),m=r(n,f,t?2:1),x=0;if("function"!=typeof g)throw TypeError(e+" is not iterable!");if(o(g)){for(p=u(e.length);p>x;x++)if(y=t?m(s(h=e[x])[0],h[1]):m(e[x]),y===c||y===l)return y}else for(v=g.call(e);!(h=v.next()).done;)if(y=a(v,m,h.value,t),y===c||y===l)return y};t.BREAK=c,t.RETURN=l},function(e,t,n){e.exports=!n(14)&&!n(35)(function(){return 7!=Object.defineProperty(n(25)("div"),"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(18);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(16),a=n(5)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[a]===e)}},function(e,t,n){var r=n(13);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(o){var s=e["return"];throw void 0!==s&&r(s.call(e)),o}}},function(e,t,n){"use strict";var r=n(76),a=n(39),o=n(27),s={};n(15)(s,n(5)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(s,{next:a(1,n)}),o(e,t+" Iterator")}},function(e,t,n){var r=n(5)("iterator"),a=!1;try{var o=[7][r]();o["return"]=function(){a=!0},Array.from(o,function(){throw 2})}catch(s){}e.exports=function(e,t){if(!t&&!a)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(u){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(8),a=n(41).set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,u=r.Promise,i="process"==n(18)(s);e.exports=function(){var e,t,n,c=function(){var r,a;for(i&&(r=s.domain)&&r.exit();e;){a=e.fn,e=e.next;try{a()}catch(o){throw e?n():t=void 0,o}}t=void 0,r&&r.enter()};if(i)n=function(){s.nextTick(c)};else if(o){var l=!0,f=document.createTextNode("");new o(c).observe(f,{characterData:!0}),n=function(){f.data=l=!l}}else if(u&&u.resolve){var d=u.resolve();n=function(){d.then(c)}}else n=function(){a.call(r,c)};return function(r){var a={fn:r,next:void 0};t&&(t.next=a),e||(e=a,n()),t=a}}},function(e,t,n){var r=n(13),a=n(77),o=n(34),s=n(28)("IE_PROTO"),u=function(){},i="prototype",c=function(){var e,t=n(25)("iframe"),r=o.length,a="<",s=">";for(t.style.display="none",n(36).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write(a+"script"+s+"document.F=Object"+a+"/script"+s),e.close(),c=e.F;r--;)delete c[i][o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(u[i]=r(e),n=new u,u[i]=null,n[s]=e):n=c(),void 0===t?n:a(n,t)}},function(e,t,n){var r=n(17),a=n(13),o=n(80);e.exports=n(14)?Object.defineProperties:function(e,t){a(e);for(var n,s=o(t),u=s.length,i=0;u>i;)r.f(e,n=s[i++],t[n]);return e}},function(e,t,n){var r=n(20),a=n(87),o=n(28)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=a(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){var r=n(20),a=n(30),o=n(65)(!1),s=n(28)("IE_PROTO");e.exports=function(e,t){var n,u=a(e),i=0,c=[];for(n in u)n!=s&&r(u,n)&&c.push(n);for(;t.length>i;)r(u,n=t[i++])&&(~o(c,n)||c.push(n));return c}},function(e,t,n){var r=n(79),a=n(34);e.exports=Object.keys||function(e){return r(e,a)}},function(e,t,n){var r=n(15);e.exports=function(e,t,n){for(var a in t)n&&e[a]?e[a]=t[a]:r(e,a,t[a]);return e}},function(e,t,n){e.exports=n(15)},function(e,t,n){"use strict";var r=n(8),a=n(11),o=n(17),s=n(14),u=n(5)("species");e.exports=function(e){var t="function"==typeof a[e]?a[e]:r[e];s&&t&&!t[u]&&o.f(t,u,{configurable:!0,get:function(){return this}})}},function(e,t,n){var r=n(13),a=n(23),o=n(5)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||void 0==(n=r(s)[o])?t:a(n)}},function(e,t,n){var r=n(29),a=n(24);e.exports=function(e){return function(t,n){var o,s,u=String(a(t)),i=r(n),c=u.length;return i<0||i>=c?e?"":void 0:(o=u.charCodeAt(i),o<55296||o>56319||i+1===c||(s=u.charCodeAt(i+1))<56320||s>57343?e?u.charAt(i):o:e?u.slice(i,i+2):(o-55296<<10)+(s-56320)+65536)}}},function(e,t,n){var r=n(29),a=Math.max,o=Math.min;e.exports=function(e,t){return e=r(e),e<0?a(e+t,0):o(e,t)}},function(e,t,n){var r=n(24);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(21);e.exports=function(e,t){if(!r(e))return e;var n,a;if(t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;if("function"==typeof(n=e.valueOf)&&!r(a=n.call(e)))return a;if(!t&&"function"==typeof(n=e.toString)&&!r(a=n.call(e)))return a;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(33),a=n(5)("iterator"),o=n(16);e.exports=n(11).getIteratorMethod=function(e){if(void 0!=e)return e[a]||e["@@iterator"]||o[r(e)]}},function(e,t,n){"use strict";var r=n(63),a=n(74),o=n(16),s=n(30);e.exports=n(37)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,a(1)):"keys"==t?a(0,n):"values"==t?a(0,e[n]):a(0,[n,e[n]])},"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},function(e,t,n){var r=n(26);r(r.S+r.F*!n(14),"Object",{defineProperty:n(17).f})},function(e,t){},function(e,t,n){"use strict";var r,a,o,s=n(38),u=n(8),i=n(19),c=n(33),l=n(26),f=n(21),d=n(23),p=n(64),h=n(66),v=n(84),y=n(41).set,g=n(75)(),m="Promise",x=u.TypeError,w=u.process,b=u[m],w=u.process,k="process"==c(w),U=function(){},T=!!function(){try{var e=b.resolve(1),t=(e.constructor={})[n(5)("species")]=function(e){e(U,U)};return(k||"function"==typeof PromiseRejectionEvent)&&e.then(U)instanceof t}catch(r){}}(),_=function(e,t){return e===t||e===b&&t===o},N=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},E=function(e){return _(b,e)?new S(e):new a(e)},S=a=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw x("Bad Promise constructor");t=e,n=r}),this.resolve=d(t),this.reject=d(n)},A=function(e){try{e()}catch(t){return{error:t}}},R=function(e,t){if(!e._n){e._n=!0;var n=e._c;g(function(){for(var r=e._v,a=1==e._s,o=0,s=function(t){var n,o,s=a?t.ok:t.fail,u=t.resolve,i=t.reject,c=t.domain;try{s?(a||(2==e._h&&I(e),e._h=1),s===!0?n=r:(c&&c.enter(),n=s(r),c&&c.exit()),n===t.promise?i(x("Promise-chain cycle")):(o=N(n))?o.call(n,u,i):u(n)):i(r)}catch(l){i(l)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&M(e)})}},M=function(e){y.call(u,function(){var t,n,r,a=e._v;if(O(e)&&(t=A(function(){k?w.emit("unhandledRejection",a,e):(n=u.onunhandledrejection)?n({promise:e,reason:a}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",a)}),e._h=k||O(e)?2:1),e._a=void 0,t)throw t.error})},O=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!O(t.promise))return!1;return!0},I=function(e){y.call(u,function(){var t;k?w.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},j=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),R(t,!0))},C=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=N(e))?g(function(){var r={_w:n,_d:!1};try{t.call(e,i(C,r,1),i(j,r,1))}catch(a){j.call(r,a)}}):(n._v=e,n._s=1,R(n,!1))}catch(r){j.call({_w:n,_d:!1},r)}}};T||(b=function(e){p(this,b,m,"_h"),d(e),r.call(this);try{e(i(C,this,1),i(j,this,1))}catch(t){j.call(this,t)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(81)(b.prototype,{then:function(e,t){var n=E(v(this,b));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=k?w.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&R(this,!1),n.promise},"catch":function(e){return this.then(void 0,e)}}),S=function(){var e=new r;this.promise=e,this.resolve=i(C,e,1),this.reject=i(j,e,1)}),l(l.G+l.W+l.F*!T,{Promise:b}),n(27)(b,m),n(83)(m),o=n(11)[m],l(l.S+l.F*!T,m,{reject:function(e){var t=E(this),n=t.reject;return n(e),t.promise}}),l(l.S+l.F*(s||!T),m,{resolve:function(e){if(e instanceof b&&_(e.constructor,this))return e;var t=E(this),n=t.resolve;return n(e),t.promise}}),l(l.S+l.F*!(T&&n(73)(function(e){b.all(e)["catch"](U)})),m,{all:function(e){var t=this,n=E(t),r=n.resolve,a=n.reject,o=A(function(){var n=[],o=0,s=1;h(e,!1,function(e){var u=o++,i=!1;n.push(void 0),s++,t.resolve(e).then(function(e){i||(i=!0,n[u]=e,--s||r(n))},a)}),--s||r(n)});return o&&a(o.error),n.promise},race:function(e){var t=this,n=E(t),r=n.reject,a=A(function(){h(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return a&&r(a.error),n.promise}})},function(e,t,n){"use strict";var r=n(85)(!0);n(37)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){n(90);for(var r=n(8),a=n(15),o=n(16),s=n(5)("toStringTag"),u=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],i=0;i<5;i++){var c=u[i],l=r[c],f=l&&l.prototype;f&&!f[s]&&a(f,s,c),o[c]=o.Array}},function(e,t){e.exports={rootPath:"/Users/roieki/Sites"}},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("colors")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("cookie-session")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("heartbeats")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("http-proxy-middleware")},function(e,t){e.exports=require("immutable")},function(e,t){e.exports=require("ioredis")},function(e,t){e.exports=require("kue")},function(e,t){e.exports=require("kue-ui")},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("passport-github")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("regenerator-runtime")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("thinky")},function(e,t){e.exports=require("wikidata-sdk")}]);